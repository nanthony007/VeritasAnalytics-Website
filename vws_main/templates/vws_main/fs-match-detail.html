{% extends "vws_main/header.html" %}
{% load staticfiles %}


{% block content %}

<div class="container">
  <div class="page-header">
    <br />
    <h2>Match {{object.matchID}}</h2>
    <hr class="yellow" />
  </div>

  <div class="row">
    <h3>Info</h3>
    <div class="table-responsive">
      <table class="table table-bordered table-sm">
        <caption>Results | Click on a wrestler to view their profile</caption>
        <thead class="indigo white-text">
          <tr>
            <th><a data-toggle="popover" data-trigger="hover" title="MatchID" data-content="">MatchID</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Date" data-content="">Date</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Weight" data-content="">Weight</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Focus Wrestler" data-content="">Focus</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Result" data-content="">Result</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Opponent" data-content="">Opponent</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="FocusScore" data-content="">FocusScore</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="OppScore" data-content="">OpponentScore</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Match Length" data-content="">Duration</a></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{object.matchID}}</td>
            <td>{{object.date}}</td>
            <td>{{object.weight}}</td>
            <td><a class="text-primary" href="/wrestlers/{{object.focus.slug}}/" class="primary-text">{{object.focus.name}}</a></td>
            <td>{{object.result}}</td>
            <td><a class="text-primary" href="/wrestlers/{{object.opponent.slug}}/">{{object.opponent.name}}</a></td>
            <td>{{object.focus_score}}</td>
            <td>{{object.opp_score}}</td>
            <td>{{object.duration}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="row">
    <canvas id="timeserieslinechart"></canvas>
  </div>

  <hr id="base-stats-table" class="yellow" />
  <div class="row">
    <h3>Base Stats</h3>
    <div class="table-responsive">
      <table class="table table-bordered table-sm">
        <caption>Cumulative counts</caption>
        <thead class="indigo white-text">
          <tr>
            <th></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Head Inside" data-content="Attempts (count)">HIa</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Head Inside" data-content="Conversions for 2 (count)">HIc2</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Head Inside" data-content="Conversions for 4 (count)">HIc4</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Head Outside" data-content="Attempts (count)">HOa</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Head Outside" data-content="Conversions for 2 (count)">HOc2</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Head Outside" data-content="Conversions for 4 (count)">HOc4</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Double" data-content="Attempts (count)">Da</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Double" data-content="Conversions for 2 (count)">Dc2</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Double" data-content="Conversions for 4 (count)">Dc4</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Low Shot" data-content="Attempts (count)">LSa</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Low Shot" data-content="Conversions for 2 (count)">LSc2</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Low Shot" data-content="Conversions for 4 (count)">LSc4</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Counter" data-content="Attempts (count)">GBa</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Counter" data-content="Conversions for 2 (count)">GBc2</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Throw" data-content="Attempts (count)">Ta</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Throw" data-content="Conversions for 2 (count)">Tc2</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Throw" data-content="Conversions for 4 (count)">Tc4</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Exposure" data-content="Exposure from Counter (count)">Exposure</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Gut" data-content="Gut Wrench turn (count)">Gut</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Leg Lace" data-content="Leg Lace turn (count)">Leg Lace</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Turn" data-content="Other Turn (count)">Turn</a></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="indigo white-text">Focus</td>
            <td>{{object.hia}}</td>
            <td>{{object.hic2}}</td>
            <td>{{object.hic4}}</td>
            <td>{{object.hoa}}</td>
            <td>{{object.hoc2}}</td>
            <td>{{object.hoc4}}</td>
            <td>{{object.da}}</td>
            <td>{{object.dc2}}</td>
            <td>{{object.dc4}}</td>
            <td>{{object.lsa}}</td>
            <td>{{object.lsc2}}</td>
            <td>{{object.lsc4}}</td>
            <td>{{object.gba}}</td>
            <td>{{object.gbc2}}</td>
            <td>{{object.ta}}</td>
            <td>{{object.tc2}}</td>
            <td>{{object.tc4}}</td>
            <td>{{object.exposure}}</td>
            <td>{{object.gut}}</td>
            <td>{{object.leg_lace}}</td>
            <td>{{object.turn}}</td>
          </tr>
          <tr>
            <td class="indigo white-text">Opponent</td>
            <td>{{object.opp_hia}}</td>
            <td>{{object.opp_hic2}}</td>
            <td>{{object.opp_hic4}}</td>
            <td>{{object.opp_hoa}}</td>
            <td>{{object.opp_hoc2}}</td>
            <td>{{object.opp_hoc4}}</td>
            <td>{{object.opp_da}}</td>
            <td>{{object.opp_dc2}}</td>
            <td>{{object.opp_dc4}}</td>
            <td>{{object.opp_lsa}}</td>
            <td>{{object.opp_lsc2}}</td>
            <td>{{object.opp_lsc4}}</td>
            <td>{{object.opp_gba}}</td>
            <td>{{object.opp_gbc2}}</td>
            <td>{{object.opp_ta}}</td>
            <td>{{object.opp_tc2}}</td>
            <td>{{object.opp_tc4}}</td>
            <td>{{object.opp_exposure}}</td>
            <td>{{object.opp_gut}}</td>
            <td>{{object.opp_leg_lace}}</td>
            <td>{{object.opp_turn}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <hr id="shot-chart-table" class="yellow" />
  <div class="row">
    <h3>Shot Comparison</h3>
    <div class="table-responsive">
      <table class="table table-bordered table-sm">
        <caption>Calculated (%)</caption>
        <thead class="indigo white-text">
          <tr>
            <th></th>
            <th><a data-toggle="popover" data-trigger="hover" title="HI%" data-content="(HIc2+HIc4)/HIa">Head Inside Rate</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="HO%" data-content="(HOc2+HOc4)/HOa">Head Outside Rate</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="D%" data-content="(Dc2+Dc4)/Da">Double Rate</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="LS%" data-content="(LSc2+LSc4)/LSa">LowShot Rate</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Counter%" data-content="(GBc2+GBc4)/GBa">Counter Rate</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="T%" data-content="(Tc2+Tc4)/Ta">Throw Rate</a></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="indigo white-text">Focus</td>
            <td>{{object.hi_rate}}</td>
            <td>{{object.ho_rate}}</td>
            <td>{{object.d_rate}}</td>
            <td>{{object.ls_rate}}</td>
            <td>{{object.gb_rate}}</td>
            <td>{{object.t_rate}}</td>
          </tr>
          <tr>
            <td class="indigo white-text">Opponent</td>
            <td>{{object.opp_hi_rate}}</td>
            <td>{{object.opp_ho_rate}}</td>
            <td>{{object.opp_d_rate}}</td>
            <td>{{object.opp_ls_rate}}</td>
            <td>{{object.opp_gb_rate}}</td>
            <td>{{object.opp_t_rate}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <hr id="adv-stats-table" class="yellow" />
  <div class="row">
    <h3>Advanced Stats and Misc.</h3>
    <div class="table-responsive">
      <table class="table table-bordered table-sm">
        <caption>Composite</caption>
        <thead class="indigo white-text">
          <tr>
            <th></th>
            <th><a data-toggle="popover" data-placement="top" data-trigger="hover" title="NPF" data-content="(TD conv/match TD conv) + (TD att/match TD att)">Neutral Pace Factor</a></th>
            <th><a data-toggle="popover" data-placement="top" data-trigger="hover" title="APM" data-content="(Defense + Offense) / Duration">Acton per Minute</a></th>
            <th><a data-toggle="popover" data-placement="top" data-trigger="hover" title="VS" data-content="Weighted Result + (NPF * APM)">Veritas Score</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Recovery" data-content="Scoring after allowing exposure or takedown">Recovery</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Pushout" data-content="">Pushout</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Pasive" data-content="Passive calls including warnings">Passive</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Violations" data-content="Illegal holds, shot clock violation, cautions, etc.">Violations</a></th>

          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="indigo white-text">Focus</td>
            <td>{{object.npf}}</td>
            <td>{{object.apm}}</td>
            <td>{{object.vs}}</td>
            <td>{{object.recovery}}</td>
            <td>{{object.pushout}}</td>
            <td>{{object.passive}}</td>
            <td>{{object.violation}}</td>
          </tr>
          <tr>
            <td class="indigo white-text">Opponent</td>
            <td>{{object.opp_npf}}</td>
            <td>{{object.opp_apm}}</td>
            <td>{{object.opp_vs}}</td>
            <td>{{object.opp_recovery}}</td>
            <td>{{object.opp_pushout}}</td>
            <td>{{object.opp_passive}}</td>
            <td>{{object.opp_violation}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>



  <hr id="matches-table-div" class="yellow" />
  <div class="row">
    <h3>Match Timeseries</h3>
    <div class="table-responsive">
      <table id="tstable" class="table table-hover table-sm">
        {% if object.matchID|length_is:"4" %}
        <caption>Timeseries for match '{{object.matchID}}' <br />
          Blue: {{object.focus.name}} | Red: {{object.opponent.name}}</caption>
        {% else %}
        <caption>Timeseries for match '{{object.matchID}}' <br />
          Blue: {{object.opponent.name}} | Red: {{object.focus.name}}</caption>
        {% endif %}
        <thead class="indigo white-text">
          <tr>
            <th><a data-toggle="popover" data-trigger="hover" title="Event Number" data-content="">Event Number</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Event Label" data-content="b_ prefix = Blue  |  r_ prefix = Red">Event Label</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Event Time" data-content="in seconds">Event_Time</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Blue Points" data-content="">Blue</a></th>
            <th><a data-toggle="popover" data-trigger="hover" title="Red Points" data-content="">Red</a></th>
          </tr>
        </thead>
        <tbody>
          {% for row in object.actions2.all %}
          <tr>
            <td>{{row.event_num}}</td>
            <td>{{row.event_lab}}</td>
            <td>{{row.event_time}}</td>
            <td>{{row.blue}}</td>
            <td>{{row.red}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script type="text/javascript" src="{% static 'vws_main/js/jquery-3.4.1.min.js' %}"></script>
<script type="text/javascript" src="{% static 'vws_main/js/popper.min.js' %}"></script>
<script type="text/javascript" src="{% static 'vws_main/js/bootstrap.min.js' %}"></script>
<script type="text/javascript" src="{% static 'vws_main/js/mdb.min.js' %}"></script>
<script type="text/javascript" src="{% static 'vws_main/js/addons/datatables.min.js' %}"></script>

<script type="text/javascript">
  new WOW().init();
  $('[data-toggle="popover"]').popover();
  $('.popover-dismiss').popover({
    trigger: 'focus'
  });
  $(document).ready(function() {
    $('#tstable').DataTable({
      'info': false,
      'paging': false,
      'scrollY': '300px',
      'scrollCollapse': true,
    });
    $('.dataTables_length').addClass('bs-select');
  });
  var tsline = document.getElementById("timeserieslinechart").getContext('2d');
  var myLineChart = new Chart(tsline, {
    type: 'line',
    data: {
      labels: [{
          %
          for row in object.actions2.all %
        }
        "{{row.event_time}}\n{{row.event_lab}}",
        {
          % endfor %
        }
      ],
      datasets: [{
          label: {
            %
            if object.matchID | length_is: "4" %
          }
          "{{object.focus.name}}" {
            %
            else %
          }
          "{{object.opponent.name}}" {
            % endif %
          },
          data: [{
              %
              for row in object.actions2.all %
            } {
              {
                row.blue
              }
            },
            {
              % endfor %
            }
          ],
          borderColor: 'rgb(63, 81, 181)',
          backgroundColor: 'rgb(255, 255, 255, 0.0)',
          borderWidth: 2,
          lineTension: 0,
        },
        {
          label: {
            %
            if object.matchID | length_is: "4" %
          }
          "{{object.opponent.name}}" {
            %
            else %
          }
          "{{object.focus.name}}" {
            % endif %
          },
          data: [{
              %
              for row in object.actions2.all %
            } {
              {
                row.red
              }
            },
            {
              % endfor %
            }
          ],
          borderColor: 'rgb(255,0,0)',
          backgroundColor: 'rgb(255, 255, 255, 0.0)',
          borderWidth: 2,
          lineTension: 0,
        }
      ]
    },
    options: {
      scales: {
        xAxes: [{
          ticks: {
            callback: function(label) {
              return label.split("\n")[0];
            }
          }
        }],
        yAxes: [{
          ticks: {
            beginAtZero: true,
          }
        }]
      },
      intersect: false,
      title: {
        display: true,
        text: 'Timeseries'
      },
      responsive: true,
      animation: {
        'duration': 2000
      },
      tooltips: {
        enabled: true,
        mode: 'index',
        callbacks: {
          title: function(tooltipItems, data) {
            return data.labels[tooltipItems[0].index];
          }
        }
      },
    }
  });
</script>

{% endblock %}